<!DOCTYPE HTML>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Main</title>
    <meta name="viewport" content="width=device-width">
    <style>html,head,body { padding:0; margin:0; }
      body { font-family: mono, calibri, helvetica, arial, sans-serif; background-color:#EEEEEC; }</style>
    <script type="text/javascript" src="/static/main.js"></script>
    <script type="text/javascript" src="/static/localvals.js"></script>
    <script type="text/javascript" src="/static/windowkey.js"></script>
    <script type="text/javascript" src="/static/taselection.js"></script>
  </head>
  <body>
    <div id="elm"></div>
    <script type="text/javascript">
      login = {{logindata}};
      sysids = {{sysids}};
      errorid = {{errorid}};
      adminsettings = {{adminsettings}};

      const { invoke } = window.__TAURI__.tauri

      function sendZIValueTauri(request) {
        console.log("sendZIValueTauri", request);
        invoke('zimsg', { msg: request })
        .then((response) => {
          console.log("response!");
          app.ports.receiveZITauriResponse.send(response) });
      }
      function sendPIValueTauri(request) {
        console.log("sendPIValueTauri", request);
        invoke('zimsg', { msg: request })
        .then((response) => {
          console.log("response!");
          app.ports.receivePITauriResponse.send(response) });
      }
      function sendAIValueTauri(request) {
        console.log("sendAIValueTauri", request);
        invoke('zimsg', { msg: request })
        .then((response) => {
          console.log("response!");
          app.ports.receiveAITauriResponse.send(response) });
      }
      function sendUIValueTauri(request) {
        console.log("sendUIValueTauri", request);
        invoke('zimsg', { msg: request })
        .then((response) => {
          console.log("response!");
          app.ports.receiveUITauriResponse.send(response) });
      }

      // `invoke` returns a Promise
      invoke('greet', { name: 'World' })
      .then((response) => console.log(response))

      app = Elm.Main.init({
        node: document.getElementById('elm'),
        flags: { seed : Math.floor(Math.random()*0x0FFFFFFF),
                 location : document.location.origin || "",
                 useragent : navigator.userAgent,
                 debugstring : "initial-info",
                 width : window.innerWidth,
                 height : window.innerHeight,
                 errorid : errorid,
                 login : login,
                 sysids : sysids,
                 adminsettings : adminsettings,
                 tauri : true}});
      // local storage
      app.ports.storeLocalVal.subscribe(storeVal);
      app.ports.getLocalVal.subscribe(getVal);
      app.ports.sendZIValueTauri.subscribe(sendZIValueTauri);
      // app.ports.clearLocalStorage.subscribe(clearStorage);

      // selected text
      app.ports.getTASelection.subscribe(getTASelection);
      app.ports.setTASelection.subscribe(setTASelection);
      // keydown events
      app.ports.sendKeyCommand.subscribe(sendKeyCommand);
      window.addEventListener( "keydown", keycheck, false );

    </script>
  </body>
</html>
